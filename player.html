<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title></title>

  <!-- CSS Netflix -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Wilson959/player@master/Netflix_3.css">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: black;
    }

    #player {
      position: absolute;
      width: 100% !important;
      height: 100% !important;
    }
  </style>
</head>

<body>

<div id="player"></div>

<!-- JW Player -->
<script src="https://cdn.jwplayer.com/libraries/DV3FtaT5.js"></script>

<script>
  const params = new URLSearchParams(window.location.search);
  const videoSrc = params.get("src");
  const videoTitle = params.get("title") || "Título Padrão"; // pega do link ou usa padrão

  if (!videoSrc) {
    document.body.innerHTML =
      "<p style='color:white;text-align:center;margin-top:20px'>Nenhum vídeo fornecido</p>";
    throw new Error("SRC não informado");
  }

  const videoType = videoSrc.includes(".m3u8") || videoSrc.includes(".txt") ? "hls" : "mp4";

  const playerInstance = jwplayer("player").setup({
    controls: true,
    sharing: false,
    hlshtml: true,
    preload: true,
    displaytitle: true,
    displaydescription: true,
    abouttext: "",
    aboutlink: "",
    skin: { name: "netflix" },
    playlist: [
      {
        title: decodeURIComponent(videoTitle), // define o título do vídeo
        description: "Estás a assistir",
        image: "https://modocineplus.com/embed/image.php?id=439079&raw=1",
        sources: [
          {
            file: decodeURIComponent(videoSrc),
            type: videoType
          }
        ],
        captions: [],
        tracks: []
      }
    ]
  });

  // BOTÃO DOWNLOAD + FORWARD 10s
  playerInstance.on("ready", function () {
    const buttonId = "download-video-button";
    const iconPath = "";
    const tooltipText = "Download Video";

    playerInstance.addButton(iconPath, tooltipText, buttonClickAction, buttonId);

    function buttonClickAction() {
      const playlistItem = playerInstance.getPlaylistItem();
      const anchor = document.createElement("a");
      anchor.href = playlistItem.file;
      anchor.download = playlistItem.file.split("/").pop();
      document.body.appendChild(anchor);
      anchor.click();
      document.body.removeChild(anchor);
    }

    const playerContainer = playerInstance.getContainer();
    const buttonContainer = playerContainer.querySelector(".jw-button-container");

    // DISPLAY forward
    const rewindContainer = playerContainer.querySelector(".jw-display-icon-rewind");
    const forwardContainer = rewindContainer.cloneNode(true);
    const forwardDisplayButton = forwardContainer.querySelector(".jw-icon-rewind");
    forwardDisplayButton.style.transform = "scaleX(-1)";
    forwardDisplayButton.ariaLabel = "";

    const nextContainer = playerContainer.querySelector(".jw-display-icon-next");
    nextContainer.parentNode.insertBefore(forwardContainer, nextContainer);
    nextContainer.style.display = "none";

    // CONTROL BAR forward
    const rewindControlBarButton = buttonContainer.querySelector(".jw-icon-rewind");
    const forwardControlBarButton = rewindControlBarButton.cloneNode(true);
    forwardControlBarButton.style.transform = "scaleX(-1)";
    forwardControlBarButton.ariaLabel = "";

    rewindControlBarButton.parentNode.insertBefore(
      forwardControlBarButton,
      rewindControlBarButton.nextElementSibling
    );

    [forwardDisplayButton, forwardControlBarButton].forEach((button) => {
      button.onclick = () => {
        playerInstance.seek(playerInstance.getPosition() + 10);
      };
    });
  });
</script>

</body>
</html>
